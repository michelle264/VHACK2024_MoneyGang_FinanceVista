import React, { useState } from 'react'
import Select from 'react-select'
import Stack from 'react-bootstrap/Stack';
import makeAnimated from 'react-select/animated';
import { Line } from 'react-chartjs-2';
import {
  Chart as ChartJS,
  CategoryScale,
  LinearScale,
  PointElement,
  LineElement,
  Title,
  Tooltip,
  Legend,
} from "chart.js";

ChartJS.register(
  CategoryScale,
  LinearScale,
  PointElement,
  LineElement,
  Title,
  Tooltip,
  Legend
);

function generateDateList() {
  const today = new Date();
  const dates = [];

  for (let i = 0; i < 30; i++) {
    const date = new Date(today);
    date.setDate(today.getDate() - i);
    dates.push(date.toISOString().split('T')[0]);
  }

  return dates;
}

function ChartComponent() {
  const chartOptions = {
    responsive: true,
    plugins: {
      title: {
        display: true,
        text: "Stock Data",
      },
    },
  };
  const [selectedOptions, setSelectedOptions] = useState([]);

  const handleChange = (selectedOptions) => {
    setSelectedOptions(selectedOptions);
    console.log(selectedOptions);
  };

  const options = [
    { value: '3182', label: 'Genting_3182' },
    { value: '1155', label: 'Maybank_1155' },
    { value: '5296', label: 'MRDIY_5296' },
    { value: '3689', label: 'F&N_3689' },
    { value: '4707', label: 'Nestle_4707' },
    { value: '1234', label: 'Apple_1234' },
    { value: '5678', label: 'Microsoft_5678' },
    { value: '9101', label: 'Amazon_9101' },
    { value: '2345', label: 'Google_2345' },
    { value: '6789', label: 'Tesla_6789' },
    { value: '3456', label: 'Facebook_3456' },
    { value: '7890', label: 'Netflix_7890' },
    { value: '1112', label: 'American_Express_1112' },
    { value: '1314', label: 'Johnson_&_Johnson_1314' },
    { value: '1516', label: 'Walmart_1516' },
    { value: '1718', label: 'Cocacola_1718' },
    { value: '1920', label: 'IBM_1920' },
    { value: '2122', label: 'Walt_Disney_2122' },
    { value: '2324', label: 'Boeing_2324' },
    { value: '2526', label: 'Verizon_2526' }
  ];

  const animatedComponents = makeAnimated();

  const datasets = [
    {
      label: 'Genting_3182',
      data: [4.187, 4.551, 4.028, 4.484, 4.791, 4.672, 3.528, 3.744, 4.625, 4.150, 5.128, 5.443, 3.994, 5.385, 4.765, 5.140, 4.764, 4.084, 4.011, 3.416, 5.332, 4.903, 4.554, 3.845, 3.917, 5.231, 4.196, 3.251, 3.513, 5.100]
    },
    {
      label: 'Maybank_1155',
      data: [9.093, 9.261, 9.731, 9.381, 9.920, 9.583, 9.658, 9.474, 9.943, 9.702, 9.823, 9.293, 9.604, 9.628, 9.410, 9.942, 9.859, 9.831, 9.516, 9.729, 9.457, 9.532, 9.636, 9.532, 9.361, 9.811, 9.568, 9.693, 9.721, 9.548]
    },
    {
      label: 'MRDIY_5296',
      data: [1.642, 1.725, 1.525, 1.725, 1.705, 1.642, 1.660, 1.681, 1.703, 1.552, 1.538, 1.729, 1.624, 1.694, 1.607, 1.604, 1.560, 1.589, 1.603, 1.504, 1.698, 1.644, 1.512, 1.703, 1.577, 1.569, 1.602, 1.655, 1.517, 1.695]
    },
    {
      label: 'F&N_3689',
      data: [30.418, 29.660, 30.279, 29.432, 28.495, 28.991, 28.281, 29.190, 28.907, 29.442, 29.136, 28.996, 28.407, 28.561, 29.057, 28.364, 28.306, 28.597, 29.319, 30.011, 29.873, 30.343, 29.891, 30.419, 29.213, 28.798, 29.581, 30.335, 29.828, 28.919]
    },
    {
      label: 'Nestle_4707',
      data: [120.042, 119.705, 121.312, 120.419, 121.347, 121.475, 121.697, 120.866, 121.538, 119.826, 121.309, 119.669, 120.675, 121.571, 120.046, 121.559, 121.200, 119.530, 120.932, 120.453, 120.887, 120.275, 120.185, 120.505, 121.391, 120.499, 119.837, 121.063, 119.706, 121.428]
    },
    {
      label: 'Apple_1234',
      data: [146.042, 145.705, 147.312, 146.419, 147.347, 147.475, 147.697, 146.866, 147.538, 145.826, 147.309, 145.669, 146.675, 147.571, 146.046, 147.559, 147.200, 145.530, 146.932, 146.453, 146.887, 146.275, 146.185, 146.505, 147.391, 146.499, 145.837, 147.063, 145.706, 147.428]
    },
    {
      label: 'Microsoft_5678',
      data: [251.042, 250.705, 252.312, 251.419, 252.347, 252.475, 252.697, 251.866, 252.538, 250.826, 252.309, 250.669, 251.675, 252.571, 251.046, 252.559, 252.200, 250.530, 251.932, 251.453, 251.887, 251.275, 251.185, 251.505, 252.391, 251.499, 250.837, 252.063, 250.706, 252.428]
    },
    {
      label: 'Amazon_9101',
      data: [3005.042, 3004.705, 3006.312, 3005.419, 3006.347, 3006.475, 3006.697, 3005.866, 3006.538, 3004.826, 3006.309, 3004.669, 3005.675, 3006.571, 3005.046, 3006.559, 3006.200, 3004.530, 3005.932, 3005.453, 3005.887, 3005.275, 3005.185, 3005.505, 3006.391, 3005.499, 3004.837, 3006.063, 3004.706, 3006.428]
    },
    {
      label: 'Google_2345',
      data: [2820.042, 2819.705, 2821.312, 2820.419, 2821.347, 2821.475, 2821.697, 2820.866, 2821.538, 2819.826, 2821.309, 2819.669, 2820.675, 2821.571, 2820.046, 2821.559, 2821.200, 2819.530, 2820.932, 2820.453, 2820.887, 2820.275, 2820.185, 2820.505, 2821.391, 2820.499, 2819.837, 2821.063, 2819.706, 2821.428]
    },
    {
      label: 'Tesla_6789',
      data: [605.042, 604.705, 606.312, 605.419, 606.347, 606.475, 606.697, 605.866, 606.538, 604.826, 606.309, 604.669, 605.675, 606.571, 605.046, 606.559, 606.200, 604.530, 605.932, 605.453, 605.887, 605.275, 605.185, 605.505, 606.391, 605.499, 604.837, 606.063, 604.706, 606.428]
    },
    {
      label: 'Facebook_3456',
      data: [334.042, 333.705, 335.312, 334.419, 335.347, 335.475, 335.697, 334.866, 335.538, 333.826, 335.309, 333.669, 334.675, 335.571, 334.046, 335.559, 335.200, 333.530, 334.932, 334.453, 334.887, 334.275, 334.185, 334.505, 335.391, 334.499, 333.837, 335.063, 333.706, 335.428]
    },
    {
      label: 'Netflix_7890',
      data: [553.042, 552.705, 554.312, 553.419, 554.347, 554.475, 554.697, 553.866, 554.538, 552.826, 554.309, 552.669, 553.675, 554.571, 553.046, 554.559, 554.200, 552.530, 553.932, 553.453, 553.887, 553.275, 553.185, 553.505, 554.391, 553.499, 552.837, 554.063, 552.706, 554.428]
    },
    {
      label: 'American_Express_1112',
      data: [121.042, 120.705, 122.312, 121.419, 122.347, 122.475, 122.697, 121.866, 122.538, 120.826, 122.309, 120.669, 121.675, 122.571, 121.046, 122.559, 122.200, 120.530, 121.932, 121.453, 121.887, 121.275, 121.185, 121.505, 122.391, 121.499, 120.837, 122.063, 120.706, 122.428]
    },
    {
      label: 'Johnson_&_Johnson_1314',
      data: [151.042, 150.705, 152.312, 151.419, 152.347, 152.475, 152.697, 151.866, 152.538, 150.826, 152.309, 150.669, 151.675, 152.571, 151.046, 152.559, 152.200, 150.530, 151.932, 151.453, 151.887, 151.275, 151.185, 151.505, 152.391, 151.499, 150.837, 152.063, 150.706, 152.428]
    },
    {
      label: 'Walmart_1516',
      data: [142.042, 141.705, 143.312, 142.419, 143.347, 143.475, 143.697, 142.866, 143.538, 141.826, 143.309, 141.669, 142.675, 143.571, 142.046, 143.559, 143.200, 141.530, 142.932, 142.453, 142.887, 142.275, 142.185, 142.505, 143.391, 142.499, 141.837, 143.063, 141.706, 143.428]
    },
    {
      label: 'Cocacola_1718',
      data: [56.042, 55.705, 57.312, 56.419, 57.347, 57.475, 57.697, 56.866, 57.538, 55.826, 57.309, 55.669, 56.675, 57.571, 56.046, 57.559, 56.500, 55.530, 56.932, 56.453, 56.887, 56.275, 56.185, 56.505, 57.391, 56.499, 55.837, 57.063, 55.706, 57.428]
    },
    {
      label: 'IBM_1920',
      data: [121.042, 120.705, 122.312, 121.419, 122.347, 122.475, 122.697, 121.866, 122.538, 120.826, 122.309, 120.669, 121.675, 122.571, 121.046, 122.559, 122.200, 120.530, 121.932, 121.453, 121.887, 121.275, 121.185, 121.505, 122.391, 121.499, 120.837, 122.063, 120.706, 122.428]
    },
    {
      label: 'Walt_Disney_2122',
      data: [171.042, 170.705, 172.312, 171.419, 172.347, 172.475, 172.697, 171.866, 172.538, 170.826, 172.309, 170.669, 171.675, 172.571, 171.046, 172.559, 172.200, 170.530, 171.932, 171.453, 171.887, 171.275, 171.185, 171.505, 172.391, 171.499, 170.837, 172.063, 170.706, 172.428]
    },
    {
      label: 'Boeing_2324',
      data: [222.042, 221.705, 223.312, 222.419, 223.347, 223.475, 223.697, 222.866, 223.538, 221.826, 223.309, 221.669, 222.675, 223.571, 222.046, 223.559, 223.200, 221.530, 222.932, 222.453, 222.887, 222.275, 222.185, 222.505, 223.391, 222.499, 221.837, 223.063, 221.706, 223.428]
    },
    {
      label: 'Verizon_2526',
      data: [58.042, 57.705, 59.312, 58.419, 59.347, 59.475, 59.697, 58.866, 59.538, 57.826, 59.309, 57.669, 58.675, 59.571, 58.046, 59.559, 59.200, 57.530, 58.932, 58.453, 58.887, 58.275, 58.185, 58.505, 59.391, 58.499, 57.837, 59.063, 57.706, 59.428]
    }
  ];
  
  function generateDatasetList() { 
    if(selectedOptions.length === 0)
      return [{label:'None'}]; 

    const selectedLabels = selectedOptions.map(option => option.label);
    const filteredDatasets = datasets.filter(dataset => selectedLabels.includes(dataset.label));
    const updatedDatasets = filteredDatasets.map(dataset => ({
      ...dataset,
      borderColor: `rgb(${getRandomNumber()}, ${getRandomNumber()}, ${getRandomNumber()})`
    }));

    
    return updatedDatasets;
  }
  
  function getRandomNumber() {
    return Math.floor(Math.random() * 256);
}
  const labels = generateDateList();

  const data = {
    labels,
    datasets: generateDatasetList()
  };

    return (
      <div className='w_tradingPagesBackground'>
        <h1 style={{margin:'15px'}}>Stock Chart</h1>
        <Stack gap={3}>
          <div className="p-2"> 
            <Select options={options} 
            closeMenuOnSelect={false}
            onChange={handleChange}
            components={animatedComponents}
            isMulti 
            />
          </div>
          <div className="p-2 w_lineChart">
            <Line options={chartOptions} data={data} style={{backgroundColor:'white'}} />
          </div>
        </Stack>
      </div>
    );
  }
  
  export default ChartComponent;